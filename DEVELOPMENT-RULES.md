# DEVELOPMENT-RULES.md - プロジェクト進行ルール

このファイルはTeam Task Manager Proの開発を進める上での共通ルールを定義します。
Claude Code、Cursor、その他のAIエージェント、人間の開発者すべてがこのルールに従ってください。

---

## 📋 目次

1. [開発前の必須確認事項](#開発前の必須確認事項)
2. [実装中のルール](#実装中のルール)
3. [完了時のルール](#完了時のルール)
4. [問題発生時のルール](#問題発生時のルール)
5. [ドキュメント管理ルール](#ドキュメント管理ルール)
6. [コミットルール](#コミットルール)
7. [セッション引き継ぎルール](#セッション引き継ぎルール)

---

## 開発前の必須確認事項

### ✅ 必ず読むドキュメント

開発を開始する前に、以下のドキュメントを**必ず**読んでください：

1. **PROJECT-PLAN.md** - 実装計画とチェックリスト
   - 現在のフェーズを確認
   - 次に実装すべき項目を確認
   - 依存関係を確認

2. **ISSUE.md** - 不具合管理表
   - 未解決課題を確認
   - 既知の問題を把握
   - 進行中のIssueを確認

3. **docs/session-handover.md** - セッション引き継ぎ情報
   - プロジェクト全体の状況を把握
   - 完了済みタスクを確認
   - 既知の制限事項を確認

4. **CLAUDE.md** - 開発ルールとコーディング規約
   - コーディング規約を確認
   - ファイル命名規則を確認
   - Gitコミットメッセージ規約を確認

5. **docs/design.md** - 設計ドキュメント
   - データモデルを確認
   - UI/UX設計を確認
   - 機能仕様を確認

### 🔍 開発開始前のチェックリスト

- [ ] PROJECT-PLAN.mdで現在のフェーズと次のタスクを確認
- [ ] ISSUE.mdで未解決課題がないか確認
- [ ] 依存するタスクが完了しているか確認
- [ ] 必要な環境変数が設定されているか確認（.env.local）
- [ ] 開発サーバーが起動するか確認（`npm run dev`）

---

## 実装中のルール

### 1. PROJECT-PLAN.mdの更新ルール

**必須**: 実装開始時と完了時にPROJECT-PLAN.mdを更新すること

#### タスク開始時
```markdown
# 変更前
- [ ] タスク名

# 変更後（開始時）
- [ ] タスク名 ← 現在作業中の項目に印をつける
```

#### タスク完了時
```markdown
# 変更前
- [ ] タスク名

# 変更後（完了時）
- [x] タスク名
```

#### フェーズ状態の更新
```markdown
# フェーズ開始時
**状態**: ⏸️ 未着手 → 🔄 進行中

# フェーズ完了時（すべての項目が[x]になったら）
**状態**: 🔄 進行中 → ✅ 完了
**完了日**: YYYY-MM-DD
```

#### 新規項目の追加
実装中に新たな作業項目が発見された場合：

```markdown
### 実行項目

- [x] 既存の完了項目
- [ ] 既存の未完了項目
- [ ] 【追加】新たに発見された作業項目 ← 必ず【追加】マークをつける
```

**追加理由の記載**:
```markdown
**追加項目の理由**:
- なぜこの項目が必要になったか
- どの機能と関連しているか
```

### 2. コーディング規約の遵守

**CLAUDE.mdのコーディング規約を必ず守ること**

- ファイル命名: PascalCase（コンポーネント）、camelCase（ユーティリティ）
- 型定義: interfaceを使用
- スタイリング: TailwindCSSを使用、インラインスタイル禁止
- コメント: 複雑なロジックのみ、自明なコードにはコメント不要
- エラーハンドリング: try-catchで適切に処理

### 3. 既存コードの確認

**必須**: 新しいファイルを作成する前に、既存のコードを確認すること

- 類似のコンポーネントがないか検索
- 既存の型定義を再利用できないか確認
- 既存のユーティリティ関数を活用

**悪い例**:
```typescript
// ❌ 既存コードを確認せずに新しい型を定義
interface Task {
  id: string;
  name: string;
}
```

**良い例**:
```typescript
// ✅ types/index.tsの既存の型を使用
import type { Task } from '@/types';
```

### 4. テストとデバッグ

**実装後は必ず動作確認を行うこと**

- [ ] `npm run dev` でローカルサーバーを起動
- [ ] ブラウザで実際に動作確認
- [ ] エラーがコンソールに出ていないか確認
- [ ] レスポンシブデザインの確認（モバイル/タブレット/デスクトップ）

---

## 完了時のルール

### 1. チェックリストの更新

**必須**: タスク完了時は即座にPROJECT-PLAN.mdを更新すること

```markdown
- [x] 完了したタスク
```

**禁止**: 複数のタスクを完了してからまとめて更新すること
- ❌ タスクA、B、Cを完了してから一気に[x]をつける
- ✅ タスクAが完了したら即座に[x]、次にタスクBを完了したら即座に[x]

### 2. 動作確認の記録

**推奨**: 完了時に動作確認の結果を記録すること

PROJECT-PLAN.mdの該当フェーズに追記:
```markdown
**動作確認結果**:
- ✅ ローカル環境で正常動作
- ✅ モバイル表示OK
- ✅ エラーなし
```

### 3. スクリーンショット

**推奨**: UIに関する実装の場合、スクリーンショットを保存

```
docs/screenshots/
  ├── phase4-task-list.png
  ├── phase5-task-modal.png
  └── ...
```

---

## 問題発生時のルール

### 🚨 必須: ISSUE.mdへの記録

**すべてのエラーと問題はISSUE.mdに記録すること**

#### Issue記録のタイミング

以下のいずれかが発生した場合、**即座に**ISSUE.mdに記録：

1. ✅ **エラーが発生した時**
   - コンパイルエラー
   - ランタイムエラー
   - ビルドエラー

2. ✅ **ユーザーから問題が報告された時**
   - 動作しない機能
   - 表示がおかしい
   - 期待と異なる動作

3. ✅ **コードレビューで問題が発見された時**
   - バグの発見
   - セキュリティ上の問題
   - パフォーマンス問題

4. ✅ **テストが失敗した時**
   - 単体テスト失敗
   - E2Eテスト失敗
   - 手動テストで問題発見

#### Issue記録のテンプレート

```markdown
### ISSUE-XXX: [問題の簡潔な説明]

**ステータス**: 🔴 未解決
**優先度**: [緊急/高/中/低]
**発生日**: YYYY-MM-DD
**報告者**: [Claude Code/Cursor/ユーザー名]
**担当者**: -

**問題内容**:
[問題の詳細な説明]

**発生箇所**:
- ファイル: [ファイル名:行数]
- 影響範囲: [影響を受ける機能やページ]

**エラーログ**:
```
[エラーメッセージをそのまま貼り付け]
```

**原因**:
[原因の説明、不明な場合は"調査中"と記載]

**対応方法**:
[解決策の説明、複数の選択肢がある場合はすべて列挙]

**進捗状況**:
- [ ] 原因調査
- [ ] 修正実装
- [ ] テスト

**関連Issue**: なし
**関連コミット**: なし
```

#### Issue番号の採番ルール

1. ISSUE.mdを開く
2. 最後のIssue番号を確認（例: ISSUE-001）
3. 次の番号を採番（例: ISSUE-002）
4. 未解決課題の件数を更新

```markdown
## 📊 現在の未解決課題

**未解決数**: 2件 ← 更新
**解決済み**: 0件
**総課題数**: 2件 ← 更新
```

#### Issue解決時のルール

問題が解決したら：

1. ✅ ステータスを更新: `🔴 未解決` → `🟢 解決済み`
2. ✅ 解決方法を記載
3. ✅ 関連コミットハッシュを記載
4. ✅ 未解決課題から解決済み課題セクションへ移動
5. ✅ 統計情報を更新

```markdown
### ISSUE-001: Supabase環境変数未設定エラー

**ステータス**: 🟢 解決済み
**解決日**: YYYY-MM-DD

**解決方法**:
.env.localファイルを作成し、Supabase認証情報を設定した。

**関連コミット**: abc1234
```

---

## ドキュメント管理ルール

### 📝 ドキュメントの更新義務

**以下の状況では必ずドキュメントを更新すること**

| 状況 | 更新するドキュメント |
|-----|-------------------|
| タスク開始時 | PROJECT-PLAN.md |
| タスク完了時 | PROJECT-PLAN.md |
| 新規項目追加時 | PROJECT-PLAN.md |
| エラー発生時 | ISSUE.md |
| エラー解決時 | ISSUE.md |
| 設計変更時 | docs/design.md |
| フェーズ完了時 | docs/session-handover.md |
| 環境設定変更時 | README.md, CLAUDE.md |

### ドキュメント更新の優先順位

1. **最優先**: ISSUE.md（エラーは即座に記録）
2. **高**: PROJECT-PLAN.md（タスク完了時に即更新）
3. **中**: docs/session-handover.md（フェーズ完了時）
4. **低**: docs/design.md（設計変更時のみ）

### ドキュメントの一貫性

**禁止**: 複数のドキュメントで異なる情報を記載すること

例：
- ❌ PROJECT-PLAN.mdで「完了」、session-handover.mdで「未着手」
- ✅ すべてのドキュメントで「完了」に統一

**更新時のチェックリスト**:
- [ ] PROJECT-PLAN.mdを更新
- [ ] 関連するdocs/session-handover.mdも更新
- [ ] ISSUE.mdに記録すべき問題はないか確認

---

## コミットルール

### Gitコミットメッセージ規約

**CLAUDE.mdの規約に従うこと**

#### フォーマット
```
<type>: <subject>

[optional body]

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

#### Type一覧
| Type | 説明 | 例 |
|------|-----|-----|
| `feat` | 新機能追加 | `feat: タスク詳細モーダルを追加` |
| `fix` | バグ修正 | `fix: タスク一覧の表示バグを修正` |
| `docs` | ドキュメント変更 | `docs: PROJECT-PLANを更新` |
| `style` | コードスタイル変更 | `style: Tailwind classを整理` |
| `refactor` | リファクタリング | `refactor: TaskTable componentを最適化` |
| `test` | テスト追加・修正 | `test: タスクCRUD関数のテストを追加` |
| `chore` | ビルド、設定ファイル等 | `chore: 依存関係を更新` |

#### コミット時の必須作業

コミット前に必ず以下を確認：

1. ✅ `git status` で変更ファイルを確認
2. ✅ `git diff` で変更内容を確認
3. ✅ 不要なファイルが含まれていないか確認
4. ✅ .env.local等の機密情報が含まれていないか確認

#### コミットタイミング

**推奨**: 小さな単位で頻繁にコミット

- ✅ 1つの機能が完成したらコミット
- ✅ 1つのバグを修正したらコミット
- ❌ 複数の機能をまとめてコミット
- ❌ 1日の終わりに全部まとめてコミット

### プッシュのルール

**本番ブランチ（main）へのプッシュ前**:

- [ ] ローカルでビルドエラーがないか確認（Windows環境では不可、クラウドで確認）
- [ ] 開発サーバーが正常に起動するか確認
- [ ] すべてのドキュメントが更新されているか確認
- [ ] ISSUE.mdに未記録の問題がないか確認

---

## セッション引き継ぎルール

### 🔄 セッション終了時の必須作業

次のエージェント（または人間）に引き継ぐ前に、以下を**必ず**実施：

#### 1. ドキュメントの最終更新

- [ ] PROJECT-PLAN.mdの完了状態を更新
- [ ] ISSUE.mdの未解決課題を確認
- [ ] docs/session-handover.mdに現在の状況を追記

#### 2. 作業中タスクの明確化

PROJECT-PLAN.mdに以下を記載：

```markdown
**現在の作業**:
- フェーズ: Phase X
- 進行中のタスク: [タスク名]
- 完了率: XX%
- 次にやるべきこと: [具体的な次のステップ]

**ブロッカー**:
- [作業を進める上での障害があれば記載]
```

#### 3. コミット＆プッシュ

```bash
# すべての変更をステージング
git add .

# コミット
git commit -m "docs: セッション終了時のドキュメント更新

- PROJECT-PLAN.mdを更新（Phase X, YY%完了）
- ISSUE.mdに未解決課題を記録
- session-handover.mdを更新

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# プッシュ
git push origin main
```

#### 4. 引き継ぎメモの作成（オプション）

複雑な状況の場合、`HANDOFF-NOTE.md` を作成：

```markdown
# セッション引き継ぎメモ

**作成日**: YYYY-MM-DD HH:MM
**作成者**: Claude Code / Cursor / [名前]

## 現在の状況
[現在の作業状況を詳細に記載]

## 次にやるべきこと
1. [具体的なタスク1]
2. [具体的なタスク2]

## 注意事項
- [引き継ぐ際に注意すべきポイント]

## 質問・懸念事項
- [解決すべき問題や疑問点]
```

### 📖 セッション開始時の必須作業

新しいセッションを開始する際：

#### 1. ドキュメントの確認（開発前の必須確認事項と同じ）

- [ ] PROJECT-PLAN.mdを読む
- [ ] ISSUE.mdを読む
- [ ] docs/session-handover.mdを読む
- [ ] HANDOFF-NOTE.md（存在する場合）を読む

#### 2. 環境確認

```bash
# 最新のコードを取得
git pull origin main

# 依存関係を確認
npm install

# 開発サーバー起動確認
npm run dev
```

#### 3. 現状確認のチェックリスト

- [ ] 現在のフェーズを確認
- [ ] 未解決課題を確認
- [ ] 前回の作業がどこまで進んだか確認
- [ ] 次にやるべきタスクを特定

---

## 違反時の対応

### ルール違反の例

以下は**禁止行為**です：

❌ **PROJECT-PLAN.mdを更新せずにタスクを進める**
❌ **エラーが発生してもISSUE.mdに記録しない**
❌ **既存コードを確認せずに新しいコードを書く**
❌ **ドキュメントに嘘を書く（完了していないのに[x]をつける）**
❌ **機密情報（.env.local）をコミットする**
❌ **コーディング規約を無視する**

### 違反に気づいた場合

1. 即座に修正する
2. ISSUE.mdに記録（タイプ: プロセス違反）
3. 今後同じ違反をしないように注意

---

## ルールの更新

### このルール自体の改善

このDEVELOPMENT-RULES.mdも改善の対象です。

**ルール追加・変更のプロセス**:

1. 問題点を特定（例: 「〇〇のルールがないため混乱した」）
2. ISSUE.mdに記録
3. ルールの追加・変更案を作成
4. DEVELOPMENT-RULES.mdを更新
5. コミット時に変更理由を明記

```bash
git commit -m "docs: DEVELOPMENT-RULESに〇〇ルールを追加

理由: [なぜこのルールが必要か]

Co-Authored-By: [担当者名]"
```

---

## クイックリファレンス

### 開発フローチャート

```
開始
  ↓
[1] PROJECT-PLAN.mdで次のタスクを確認
  ↓
[2] ISSUE.mdで未解決課題を確認
  ↓
[3] 開発開始（タスクを[ ]から[x]へ）
  ↓
[4] 実装中に問題発生？
  ├─ YES → ISSUE.mdに記録 → 解決 → 続行
  └─ NO  → 続行
  ↓
[5] タスク完了 → PROJECT-PLAN.mdを更新（[ ]→[x]）
  ↓
[6] 動作確認
  ├─ OK  → 次のタスクへ
  └─ NG  → ISSUE.mdに記録 → 修正
  ↓
[7] フェーズ完了？
  ├─ YES → ステータス更新（🔄→✅）
  └─ NO  → 次のタスクへ
  ↓
[8] コミット＆プッシュ
  ↓
終了
```

### 重要ドキュメント一覧

| ドキュメント | 用途 | 更新タイミング |
|------------|------|--------------|
| **PROJECT-PLAN.md** | 実装計画 | タスク開始/完了時 |
| **ISSUE.md** | 不具合管理 | エラー発生/解決時 |
| **docs/session-handover.md** | セッション引き継ぎ | フェーズ完了時 |
| **CLAUDE.md** | 開発ルール | ほぼ更新不要 |
| **docs/design.md** | 設計書 | 設計変更時 |
| **DEVELOPMENT-RULES.md** | このファイル | ルール追加時 |

---

## まとめ

### 🎯 最も重要な3つのルール

1. **PROJECT-PLAN.mdを常に最新に保つ**
   - タスク開始時と完了時に即更新

2. **問題は必ずISSUE.mdに記録**
   - すべてのエラーと問題を即座に記録

3. **既存ドキュメントを必ず読んでから開発開始**
   - PROJECT-PLAN.md、ISSUE.md、session-handover.mdを確認

### 📌 これだけは覚えておくこと

> **「問題が起きたら → ISSUE.mdに記録」**
> **「タスクが完了したら → PROJECT-PLAN.mdを更新」**
> **「開発前に → ドキュメント3つを確認」**

---

*最終更新: 2026-01-18*
*管理者: Claude Sonnet 4.5*
*バージョン: 1.0.0*
