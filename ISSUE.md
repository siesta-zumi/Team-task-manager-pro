# ISSUE.md - 不具合管理表

このファイルはプロジェクトで発生した問題・課題を記録し、追跡するための管理表です。

---

## 📊 現在の未解決課題

**未解決数**: 0件
**解決済み**: 3件
**総課題数**: 3件

---

## 🚨 未解決課題

現在、未解決の課題はありません。

---

## ✅ 解決済み課題

### ISSUE-001: Supabase環境変数未設定エラー

**ステータス**: 🟢 解決済み（回避策実装）
**優先度**: 高
**発生日**: 2026-01-18
**解決日**: 2026-01-18
**報告者**: ユーザー（開発サーバーアクセス時）
**担当者**: Claude Sonnet 4.5

**問題内容**:
```
Error: supabaseUrl is required.
at lib\supabase.ts:6:37
```

タスク一覧ページ (`/tasks`) にアクセスすると500エラーが発生。Supabaseクライアントの初期化時に環境変数が未設定のためエラーが発生している。

**発生箇所**:
- ファイル: `lib/supabase.ts:6`
- 影響範囲: タスク一覧ページ (`app/tasks/page.tsx`)

**エラーログ**:
```
⨯ Error: supabaseUrl is required.
  at __TURBOPACK__module__evaluation__ (lib\supabase.ts:6:37)
  at __TURBOPACK__module__evaluation__ (lib\tasks.ts:1:1)
  at __TURBOPACK__module__evaluation__ (app\tasks\page.tsx:2:1)

4 | const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
5 |
> 6 | export const supabase = createClient(supabaseUrl, supabaseAnonKey);
  |                                     ^
```

**原因**:
1. `.env.local` ファイルが存在しない、または環境変数が設定されていない
2. Supabaseプロジェクトがまだ作成されていない
3. 環境変数名の誤り

**実施した対応**:

**回避策（オプション2を実装）**:
1. ✅ `lib/supabase.ts` にフォールバック値を追加
   ```typescript
   const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://placeholder.supabase.co';
   const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'placeholder-anon-key';
   ```
2. ✅ `lib/tasks.ts` のエラーハンドリング改善
   - Supabase未接続時は空配列を返す
   - `console.error` → `console.warn` に変更（警告レベル）
3. ✅ `app/tasks/page.tsx` のエラー表示改善
   - Supabase未接続時は警告メッセージのみ表示
   - アプリケーションは正常に動作継続

**動作確認結果**:
- ✅ タスク一覧ページが正常に表示される
- ✅ 500エラーが解消
- ✅ コンソールエラーが警告レベルに変更
- ✅ UI開発を継続可能

**本番環境への移行時の対応**:
ユーザー側で以下を実施すれば、実際のデータベースに接続可能:
1. Supabaseプロジェクト作成
2. `.env.local` に環境変数設定
3. 開発サーバー再起動

**関連Issue**: なし
**関連コミット**: d4bc919 (2026-01-18)

---

### ISSUE-002: タスク一覧ページでエラーオブジェクトが空 `{}` として表示される

**ステータス**: 🟢 解決済み
**優先度**: 中
**発生日**: 2026-01-19
**解決日**: 2026-01-19
**報告者**: ユーザー（開発サーバーアクセス時）
**担当者**: Claude Sonnet 4.5

**問題内容**:
```
Error fetching tasks: {}
タスクの取得に失敗: {}
```

タスク一覧ページ (`/tasks`) で、Supabase接続エラー時にエラーオブジェクトが空 `{}` として表示され、適切なエラーハンドリングが行われていなかった。

**発生箇所**:
- ファイル: `lib/tasks.ts:38`
- ファイル: `app/tasks/page.tsx:228`
- 影響範囲: タスク一覧ページ (`app/tasks/page.tsx`)

**エラーログ**:
```
Error fetching tasks: {}
  at getTasks (lib/tasks.ts:38:13)
  at async TasksPage.useEffect.fetchTasks (app/tasks/page.tsx:19:22)

タスクの取得に失敗: {}
  at TasksPage.useEffect.fetchTasks (app/tasks/page.tsx:228:19)
```

**原因**:
1. Supabaseのエラーオブジェクトが正しくシリアライズされていない
2. `error.message` が存在しない場合、エラーハンドリングが適切に機能しない
3. プレースホルダー値（`https://placeholder.supabase.co`）での接続エラーが適切に検出されていない
4. エラーオブジェクトが空 `{}` の場合の処理が不足

**実施した対応**:

1. ✅ `lib/tasks.ts` のエラーハンドリング改善
   - プレースホルダー値の検出を追加（環境変数未設定時は即座に空配列を返す）
   - エラーオブジェクトの詳細を取得（message, code, details, hint）
   - エラーメッセージの正規化処理を追加
   - 空オブジェクト `{}` の検出を追加

2. ✅ `app/tasks/page.tsx` のエラーハンドリング改善
   - エラーオブジェクトが空 `{}` の場合の処理を追加
   - エラーメッセージの取得方法を改善（Error、オブジェクト、その他に対応）
   - プレースホルダー値や空オブジェクトの検出を追加

**動作確認結果**:
- ✅ プレースホルダー値検出時は即座にモックデータを使用
- ✅ エラーオブジェクトが空 `{}` の場合も適切に処理
- ✅ コンソールエラーが解消され、警告メッセージのみ表示
- ✅ タスク一覧ページが正常に動作

**関連Issue**: なし
**関連コミット**: 未コミット（2026-01-19修正）

---

### ISSUE-003: タスク詳細モーダルでタスク取得に失敗する

**ステータス**: 🟢 解決済み
**優先度**: 中
**発生日**: 2026-01-19
**解決日**: 2026-01-19
**報告者**: ユーザー（タスクモーダル表示時）
**担当者**: Claude Sonnet 4.5

**問題内容**:
```
Error fetching task: {}
タスクの取得に失敗しました
```

タスク詳細モーダルを開いた際に、`getTask`関数でエラーが発生し、エラーオブジェクトが空 `{}` として表示されていた。モックデータ環境ではタスク詳細を取得できず、エラーメッセージが表示されていた。

**発生箇所**:
- ファイル: `lib/tasks.ts:121`
- ファイル: `components/TaskModal.tsx:62`
- 影響範囲: タスク詳細モーダル (`components/TaskModal.tsx`)

**エラーログ**:
```
Error fetching task: {}
  at getTask (lib/tasks.ts:121:13)
  at async TaskModal.useEffect.fetchTask (components/TaskModal.tsx:44:28)

Error fetching task: {}
  at TaskModal.useEffect.fetchTask (components/TaskModal.tsx:62:19)
```

**原因**:
1. `getTask`関数でエラーハンドリングが不十分だった（`getTasks`と同様の問題）
2. プレースホルダー値での接続エラーが適切に検出されていない
3. エラーオブジェクトが空 `{}` の場合の処理が不足
4. モックデータ環境でタスク詳細を取得する方法がなかった

**実施した対応**:

1. ✅ `lib/tasks.ts` の `getTask` 関数のエラーハンドリング改善
   - プレースホルダー値の検出を追加
   - エラーオブジェクトの詳細を取得（message, code, details, hint）
   - エラーメッセージの正規化処理を追加
   - 空オブジェクト `{}` の検出を追加

2. ✅ `components/TaskModal.tsx` のエラーハンドリング改善
   - エラーオブジェクトが空 `{}` の場合の処理を追加
   - エラーメッセージの取得方法を改善
   - モックデータ環境対応：タスク一覧をpropsとして受け取り、エラー時にタスク一覧から該当タスクを見つける機能を追加

3. ✅ `app/tasks/page.tsx` の更新
   - `TaskModal`に`tasks`配列をpropsとして渡すように修正

**動作確認結果**:
- ✅ プレースホルダー値検出時は適切なエラーメッセージを表示
- ✅ モックデータ環境では、タスク一覧から該当タスクを見つけて表示
- ✅ エラーオブジェクトが空 `{}` の場合も適切に処理
- ✅ タスク詳細モーダルが正常に動作

**関連Issue**: ISSUE-002（同様のエラーハンドリング問題）
**関連コミット**: 未コミット（2026-01-19修正）

---

## 📋 既知の制限事項（Issue扱いではない）

### LIMIT-001: Windows環境でのプロダクションビルドエラー

**ステータス**: ⚠️ 既知の制限事項（回避策あり）
**発生日**: プロジェクト初期
**影響**: ローカルでのプロダクションビルドができない

**問題内容**:
```bash
npm run build
# TypeError: generate is not a function
```

**原因**:
Windows環境でのNext.js 15 + TailwindCSS v3 + nanoid/PostCSSの互換性問題

**回避策**:
- ローカル開発: `npm run dev` を使用（正常動作）
- 本番ビルド: Vercel/Netlifyなどのクラウド環境でビルド（Linux環境では問題なし）

**検証済みの試行**:
- Node.js 20/22/24 すべてで同じエラー
- Next.js 15/16 すべてで同じエラー
- 静的エクスポート、スタンドアロンビルド、Webpack、Babel すべて失敗

**結論**: 開発は継続可能、本番デプロイ時にクラウド環境でビルドする運用で対応

詳細: `docs/session-handover.md` 参照

---

## 📝 Issue記録ルール

### Issueの記録タイミング

1. **ユーザーからのエラー報告があった時**
2. **コードレビューでバグを発見した時**
3. **新機能実装中に問題が発覚した時**
4. **テスト実行でエラーが発生した時**

### Issue番号の付与ルール

- フォーマット: `ISSUE-XXX` (XXXは3桁の連番)
- 例: `ISSUE-001`, `ISSUE-002`, ...
- 解決済みでも番号は欠番にしない（履歴として残す）

### ステータス

- 🔴 **未解決**: 対応中または未着手
- 🟡 **調査中**: 原因を調査中
- 🟢 **解決済み**: 修正完了、テスト済み
- ⚠️ **保留**: 優先度が低い、または他の作業待ち

### 優先度

- **緊急**: アプリケーションが動作しない致命的なエラー
- **高**: 主要機能が使えない、データ損失の可能性がある
- **中**: 機能に支障があるが回避策がある
- **低**: UI/UXの問題、軽微なバグ

### Issueテンプレート

```markdown
### ISSUE-XXX: [問題の簡潔な説明]

**ステータス**: 🔴 未解決
**優先度**: [緊急/高/中/低]
**発生日**: YYYY-MM-DD
**報告者**: [ユーザー/開発者]
**担当者**: [担当者名]

**問題内容**:
[問題の詳細な説明]

**発生箇所**:
- ファイル: [ファイル名:行数]
- 影響範囲: [影響を受ける機能やページ]

**エラーログ**:
```
[エラーメッセージ]
```

**原因**:
[原因の説明]

**対応方法**:
[解決策の説明]

**進捗状況**:
- [ ] タスク1
- [ ] タスク2

**関連Issue**: [関連するIssue番号]
**関連コミット**: [コミットハッシュ]
```

---

## 🔍 フェーズ別Issue履歴

### Phase 1: プロジェクトセットアップ（完了）
- Issue発生なし

### Phase 2: ドキュメント作成（完了）
- Issue発生なし

### Phase 3: Supabase基盤構築（完了）
- Issue発生なし

### Phase 4: UI実装 - タスク一覧ページ（進行中）
- **ISSUE-001**: Supabase環境変数未設定エラー（✅ 解決済み - 回避策実装）
- **ISSUE-002**: エラーオブジェクトが空 `{}` として表示される（✅ 解決済み - エラーハンドリング改善）

### Phase 5: UI実装 - タスク詳細モーダル（進行中）
- **ISSUE-003**: タスク詳細モーダルでタスク取得に失敗する（✅ 解決済み - エラーハンドリング改善、モックデータ対応）

### Phase 6〜14: その他フェーズ（未着手）
- 未実装

---

## 📈 統計情報

### 月別Issue発生数

**2026年1月**: 3件（未解決: 0件、解決済み: 3件）

### 優先度別

- 緊急: 0件
- 高: 1件（解決済み）
- 中: 2件（解決済み）
- 低: 0件

### カテゴリ別

- 環境設定: 1件（解決済み）
- バグ: 2件（解決済み）
- UI/UX: 0件
- パフォーマンス: 0件
- セキュリティ: 0件

---

*最終更新: 2026-01-19 (ISSUE-003解決)*
*管理者: Claude Sonnet 4.5*
