# PROJECT-PLAN.md - プロジェクト実装計画書

このファイルはTeam Task Manager Proの実装手順を管理するチェックリストです。
上から順番に実装し、完了毎にチェックを付けてプロジェクトの進捗を管理します。

**セッション引き継ぎ時の注意**:
このファイルを確認して、どこまで完了しているか把握してから開発を継続してください。

---

## 📊 進捗状況サマリー

- **全体進捗**: 約30% (Phase 1-3完了、Phase 4進行中)
- **完了フェーズ**: 3/10
- **現在のフェーズ**: Phase 4 - UI実装（タスク一覧）
- **次のフェーズ**: Phase 5 - UI実装（タスク詳細モーダル）

---

## Phase 1: プロジェクトセットアップ ✅

**状態**: ✅ 完了
**開始日**: 2026-01-18
**完了日**: 2026-01-18

### 実行項目

- [x] GitHubリポジトリ作成
  - [x] リポジトリ名: `Team-task-manager-pro`
  - [x] リポジトリURL: https://github.com/siesta-zumi/Team-task-manager-pro
  - [x] ローカルにクローン

- [x] Next.js 15プロジェクト初期化
  - [x] `npx create-next-app@latest` 実行
  - [x] TypeScript有効化
  - [x] App Router使用
  - [x] TailwindCSS v3設定
  - [x] ESLint設定

- [x] 依存関係のインストール
  - [x] `@supabase/supabase-js` インストール
  - [x] その他必要なパッケージ確認

- [x] 初回コミット・プッシュ
  - [x] `.gitignore` 設定確認
  - [x] 初回コミット作成
  - [x] `main` ブランチにプッシュ

**成果物**:
- ✅ 基本的なNext.jsプロジェクト構造
- ✅ package.json with 必要な依存関係
- ✅ TailwindCSS設定ファイル

---

## Phase 2: ドキュメント作成 ✅

**状態**: ✅ 完了
**開始日**: 2026-01-18
**完了日**: 2026-01-18

### 実行項目

- [x] README.md作成
  - [x] プロジェクト概要
  - [x] 技術スタック
  - [x] セットアップ手順
  - [x] 開発コマンド

- [x] CLAUDE.md作成（開発ルール）
  - [x] ディレクトリ構成
  - [x] コーディング規約
  - [x] Git コミットメッセージ規約
  - [x] よく使うコマンド一覧

- [x] docs/design.md作成（設計ドキュメント）
  - [x] 機能仕様
  - [x] データモデル（ER図）
  - [x] テーブル定義
  - [x] TypeScript型定義
  - [x] UI/UX設計（SharePoint風）

- [x] docs/session-handover.md作成
  - [x] プロジェクト概要
  - [x] 完了済みタスク一覧
  - [x] 既知の問題
  - [x] 次のステップ

- [x] ISSUE.md作成（不具合管理表）
  - [x] 現在の未解決課題
  - [x] Issue記録ルール
  - [x] フェーズ別Issue履歴

- [x] PROJECT-PLAN.md作成（このファイル）
  - [x] フェーズ別実装計画
  - [x] 実行項目チェックリスト

**成果物**:
- ✅ 完全なプロジェクトドキュメント
- ✅ 開発ルールとコーディング規約
- ✅ 設計仕様書

---

## Phase 3: Supabase基盤構築 ✅

**状態**: ✅ 完了
**開始日**: 2026-01-18
**完了日**: 2026-01-18

### 実行項目

- [x] Supabaseクライアント設定
  - [x] `lib/supabase.ts` 作成
  - [x] 環境変数設定（`.env.local.example`）
  - [x] createClient設定

- [x] TypeScript型定義
  - [x] `types/index.ts` - アプリケーション型定義
  - [x] `types/database.ts` - Supabase型定義
  - [x] Task, Member, Subtask, Assignment型

- [x] データベースマイグレーション
  - [x] `supabase/migrations/001_initial_schema.sql` 作成
    - [x] members テーブル
    - [x] tasks テーブル
    - [x] task_assignments テーブル
    - [x] subtasks テーブル
  - [x] `supabase/migrations/002_seed_data.sql` 作成
    - [x] サンプルメンバーデータ
    - [x] サンプルタスクデータ
    - [x] サンプル担当者データ
    - [x] サンプルチェックリストデータ

- [x] CRUD関数の実装
  - [x] `lib/tasks.ts` - タスク管理
    - [x] getTasks() - 全タスク取得
    - [x] getTaskById() - タスク詳細取得
    - [x] createTask() - タスク作成
    - [x] updateTask() - タスク更新
    - [x] deleteTask() - タスク削除
  - [x] `lib/members.ts` - メンバー管理
    - [x] getMembers() - 全メンバー取得
    - [x] getMemberById() - メンバー詳細取得
    - [x] createMember() - メンバー作成
    - [x] updateMember() - メンバー更新
  - [x] `lib/subtasks.ts` - チェックリスト管理
    - [x] getSubtasksByTaskId() - タスクのチェックリスト取得
    - [x] createSubtask() - チェックリスト作成
    - [x] updateSubtask() - チェックリスト更新
    - [x] deleteSubtask() - チェックリスト削除

**成果物**:
- ✅ Supabase接続設定
- ✅ 完全な型定義
- ✅ データベーススキーマ
- ✅ CRUD関数ライブラリ

**既知の問題**:
- ⚠️ ISSUE-001: Supabase環境変数未設定エラー（ユーザー側対応待ち）

---

## Phase 4: UI実装 - タスク一覧ページ 🔄

**状態**: 🔄 進行中
**開始日**: 2026-01-18
**完了予定**: -

### 実行項目

- [x] ホームページ作成
  - [x] `app/page.tsx` 修正
  - [x] タイトルと説明
  - [x] タスク一覧へのリンク

- [x] タスク一覧ページ（基本）
  - [x] `app/tasks/page.tsx` 作成（Server Component）
  - [x] getTasks()でデータ取得
  - [x] エラーハンドリング
  - [x] `export const dynamic = 'force-dynamic'` 設定

- [x] タスクテーブルコンポーネント
  - [x] `components/TaskTable.tsx` 作成（Client Component）
  - [x] SharePoint風のテーブルデザイン
  - [x] ステータス色分け（未着手/進行中/完了/承認済み）
  - [x] 担当者アバター表示（最大3名 + 残り人数）
  - [x] 進捗バー表示
  - [x] 業務スコア表示
  - [x] 日付フォーマット（MM/DD）
  - [x] 行のホバー効果
  - [x] クリックイベント（onTaskClick）

- [x] 統計情報カード
  - [x] 総タスク数
  - [x] 進行中タスク数
  - [x] 完了タスク数
  - [x] 平均進捗率

- [ ] フィルター・検索機能
  - [x] フィルターUI（ステータス選択）- UI のみ
  - [x] 検索UI（タスク名検索）- UI のみ
  - [ ] フィルターロジック実装
  - [ ] 検索ロジック実装
  - [ ] URLクエリパラメータでフィルター状態保持

- [ ] ソート機能
  - [ ] タスク名でソート
  - [ ] ステータスでソート
  - [ ] 期限日でソート
  - [ ] 進捗率でソート
  - [ ] ソート方向切り替え（昇順/降順）

- [ ] ページネーション
  - [ ] ページサイズ選択（10, 25, 50, 100）
  - [ ] ページ番号表示
  - [ ] 前へ/次へボタン
  - [ ] 総件数表示

- [x] 新規タスクボタン
  - [x] ボタンUI作成
  - [ ] モーダル起動イベント（Phase 5で実装）

**成果物**:
- ✅ タスク一覧ページ（基本機能）
- ✅ SharePoint風テーブルコンポーネント
- ✅ 統計情報ダッシュボード
- ⏳ フィルター・検索機能（UI完成、ロジック未実装）

**現在の課題**:
- 🔴 ISSUE-001: Supabase環境変数未設定（/tasksページが500エラー）

---

## Phase 5: UI実装 - タスク詳細モーダル ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 4完了後

### 実行項目

- [ ] モーダルコンポーネント作成
  - [ ] `components/TaskModal.tsx` 作成
  - [ ] オーバーレイ背景
  - [ ] モーダルウィンドウ
  - [ ] 閉じるボタン（X、ESCキー、背景クリック）

- [ ] タスク詳細表示
  - [ ] タスク名表示・編集
  - [ ] 説明文表示・編集（Textarea）
  - [ ] ステータス選択（ドロップダウン）
  - [ ] 開始日・期限日（日付ピッカー）
  - [ ] 業務スコア表示・編集
  - [ ] 進捗率表示（チェックリストから自動計算）

- [ ] チェックリスト機能
  - [ ] チェックリスト項目一覧表示
  - [ ] チェックボックスでON/OFF
  - [ ] 新規項目追加
  - [ ] 項目削除
  - [ ] 項目編集（インライン）
  - [ ] 進捗率の自動計算
    - [ ] 完了数 / 総数 × 100
    - [ ] タスクの進捗率に反映

- [ ] 担当者アサイン
  - [ ] 担当者一覧表示
  - [ ] メイン担当/フォロー担当の区別
  - [ ] 担当者追加（メンバー選択ドロップダウン）
  - [ ] 担当者削除
  - [ ] ロール変更（メイン⇔フォロー）
  - [ ] 負荷率表示（メイン100%、フォロー30%）

- [ ] 保存・キャンセル
  - [ ] 保存ボタン（updateTask実行）
  - [ ] キャンセルボタン（変更破棄）
  - [ ] 保存中のローディング表示
  - [ ] 保存成功/失敗のトースト通知

- [ ] 新規タスク作成モード
  - [ ] createTask実行
  - [ ] デフォルト値設定
  - [ ] 必須項目のバリデーション

**成果物**:
- ⏳ タスク詳細モーダルコンポーネント
- ⏳ チェックリスト機能
- ⏳ 担当者アサイン機能

---

## Phase 6: UI実装 - 新規タスク作成機能 ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 5完了後

### 実行項目

- [ ] 新規タスク作成モーダル
  - [ ] タスク詳細モーダルを新規作成モードで開く
  - [ ] フォーム初期値設定
    - [ ] ステータス: "未着手"
    - [ ] 進捗率: 0%
    - [ ] 開始日: 今日
    - [ ] 期限日: 1週間後

- [ ] バリデーション
  - [ ] タスク名必須チェック
  - [ ] 期限日 >= 開始日チェック
  - [ ] 業務スコア範囲チェック（1-10）
  - [ ] エラーメッセージ表示

- [ ] タスク作成実行
  - [ ] createTask() API呼び出し
  - [ ] 担当者の同時登録
  - [ ] チェックリストの同時登録（オプション）
  - [ ] 作成成功後、タスク一覧を再取得
  - [ ] トースト通知表示

**成果物**:
- ⏳ 新規タスク作成機能
- ⏳ フォームバリデーション

---

## Phase 7: UI実装 - フィルター・検索機能完成 ⏸️

**状態**: ⏸️ 未着手（UI作成済み、ロジック未実装）
**開始予定**: Phase 6完了後

### 実行項目

- [ ] ステータスフィルター
  - [ ] ステータス選択でフィルタリング
  - [ ] 複数ステータス選択対応
  - [ ] "すべて"オプション

- [ ] タスク名検索
  - [ ] 入力値での部分一致検索
  - [ ] リアルタイム検索（debounce処理）
  - [ ] 検索結果件数表示

- [ ] 担当者フィルター
  - [ ] 担当者選択でフィルタリング
  - [ ] 自分のタスクのみ表示オプション

- [ ] 期限日フィルター
  - [ ] 期限切れタスク表示
  - [ ] 今週のタスク表示
  - [ ] カスタム期間選択

- [ ] フィルター状態の永続化
  - [ ] URLクエリパラメータに保存
  - [ ] ブラウザバック/フォワード対応
  - [ ] LocalStorageに最後のフィルター保存

**成果物**:
- ⏳ 完全なフィルター・検索機能
- ⏳ URLベースのフィルター状態管理

---

## Phase 8: UI実装 - ソート・ページネーション ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 7完了後

### 実行項目

- [ ] ソート機能
  - [ ] カラムヘッダークリックでソート
  - [ ] ソート方向インジケーター（↑↓）
  - [ ] ソート状態の保存（LocalStorage）

- [ ] ページネーション
  - [ ] ページサイズ選択UI
  - [ ] ページ番号ボタン
  - [ ] 前へ/次へボタン
  - [ ] 総ページ数表示
  - [ ] URLパラメータでページ状態保持

- [ ] パフォーマンス最適化
  - [ ] useMemoでフィルター結果をメモ化
  - [ ] 仮想スクロール検討（大量データ対応）

**成果物**:
- ⏳ ソート機能
- ⏳ ページネーション
- ⏳ パフォーマンス最適化

---

## Phase 9: マニュアル・チーム機能 ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 8完了後

### 実行項目

- [ ] マニュアルエディタ
  - [ ] `app/manuals/page.tsx` 作成
  - [ ] Markdownエディタコンポーネント
  - [ ] プレビュー表示
  - [ ] マニュアル一覧
  - [ ] マニュアルCRUD機能

- [ ] マニュアルとチェックリストの連動
  - [ ] H2見出しをチェックリスト項目として同期
  - [ ] 手動同期ボタン
  - [ ] 自動同期オプション

- [ ] チームダッシュボード
  - [ ] `app/dashboard/page.tsx` 作成
  - [ ] チームメンバー一覧
  - [ ] メンバー別タスク数
  - [ ] メンバー別進捗率
  - [ ] 負荷状況グラフ

- [ ] 負荷可視化グラフ
  - [ ] Chart.jsまたはRechartsインストール
  - [ ] 業務スコア合計表示
  - [ ] メイン担当100%、フォロー30%計算
  - [ ] 棒グラフで表示
  - [ ] 負荷超過の警告表示

**成果物**:
- ⏳ Markdownマニュアルエディタ
- ⏳ チームダッシュボード
- ⏳ 負荷可視化グラフ

---

## Phase 10: カレンダー・管理機能 ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 9完了後

### 実行項目

- [ ] カレンダービュー
  - [ ] `app/calendar/page.tsx` 作成
  - [ ] react-big-calendarまたは独自実装
  - [ ] タスクを期限日で表示
  - [ ] 月/週/日表示切り替え
  - [ ] カレンダー上でタスク作成

- [ ] 承認ワークフロー
  - [ ] 「完了」→「承認済み」ボタン
  - [ ] 承認権限チェック（将来的に認証機能追加時）
  - [ ] 承認履歴記録

- [ ] タスクリセット機能
  - [ ] 単発タスク: アーカイブ
  - [ ] 継続タスク: 進捗0%、未着手に戻す
  - [ ] リセット実行ボタン

- [ ] アーカイブ機能
  - [ ] アーカイブ一覧ページ
  - [ ] アーカイブからの復元
  - [ ] アーカイブの完全削除

**成果物**:
- ⏳ カレンダービュー
- ⏳ 承認ワークフロー
- ⏳ アーカイブ機能

---

## Phase 11: AI機能統合 ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 10完了後

### 実行項目

- [ ] Google GenAI設定
  - [ ] 環境変数設定（API_KEY）
  - [ ] `lib/genai.ts` 作成
  - [ ] gemini-2.5-flash モデル設定

- [ ] チェックリスト自動生成
  - [ ] タスク名から推奨チェックリスト生成
  - [ ] 「AIで提案」ボタン
  - [ ] 生成結果を編集可能な状態で表示
  - [ ] 採用/破棄選択

- [ ] 説明文清書機能
  - [ ] 説明文の文法チェック
  - [ ] より明確な表現に修正
  - [ ] 「AIで清書」ボタン
  - [ ] 修正前/修正後の比較表示

- [ ] タスク分析（将来拡張）
  - [ ] タスクの優先順位提案
  - [ ] 所要時間の推定
  - [ ] 類似タスクの検索

**成果物**:
- ⏳ Google GenAI統合
- ⏳ チェックリスト自動生成
- ⏳ 説明文清書機能

---

## Phase 12: 認証機能（オプション） ⏸️

**状態**: ⏸️ 未着手（オプション機能）
**開始予定**: Phase 11完了後（必要に応じて）

### 実行項目

- [ ] Supabase Auth設定
  - [ ] Email/Password認証
  - [ ] Google OAuth（オプション）
  - [ ] ログインページ作成
  - [ ] サインアップページ作成

- [ ] ユーザーセッション管理
  - [ ] ログイン状態チェック
  - [ ] ログアウト機能
  - [ ] セッション永続化

- [ ] Row Level Security (RLS)
  - [ ] タスクの所有者チェック
  - [ ] チームメンバーのみアクセス許可
  - [ ] RLSポリシー作成

**成果物**:
- ⏳ 認証機能
- ⏳ セキュアなデータアクセス

---

## Phase 13: テスト・品質保証 ⏸️

**状態**: ⏸️ 未着手
**開始予定**: 主要機能完成後

### 実行項目

- [ ] 単体テスト
  - [ ] Jestセットアップ
  - [ ] CRUD関数のテスト
  - [ ] コンポーネントのテスト（React Testing Library）

- [ ] E2Eテスト
  - [ ] Playwrightセットアップ
  - [ ] タスク作成フローのテスト
  - [ ] フィルター・検索のテスト

- [ ] バグ修正
  - [ ] ISSUE.mdの未解決課題を解決
  - [ ] コードレビューで発見された問題を修正

- [ ] パフォーマンス最適化
  - [ ] Lighthouseスコア改善
  - [ ] 画像最適化
  - [ ] コード分割

**成果物**:
- ⏳ テストスイート
- ⏳ 高品質なコード

---

## Phase 14: デプロイ・本番環境 ⏸️

**状態**: ⏸️ 未着手
**開始予定**: Phase 13完了後

### 実行項目

- [ ] Vercelデプロイ
  - [ ] Vercelプロジェクト作成
  - [ ] GitHubリポジトリ連携
  - [ ] 環境変数設定
  - [ ] 自動デプロイ設定

- [ ] Supabase本番環境
  - [ ] 本番用Supabaseプロジェクト作成
  - [ ] マイグレーション実行
  - [ ] RLS有効化
  - [ ] バックアップ設定

- [ ] ドメイン設定（オプション）
  - [ ] カスタムドメイン設定
  - [ ] SSL証明書設定

- [ ] モニタリング
  - [ ] エラー監視（Sentry等）
  - [ ] アクセス解析（Vercel Analytics）

**成果物**:
- ⏳ 本番環境デプロイ
- ⏳ 継続的デプロイメント

---

## 📝 開発ガイドライン

### セッション引き継ぎ時の手順

1. **現状確認**
   - このファイル（PROJECT-PLAN.md）を確認
   - ISSUE.mdで未解決課題を確認
   - docs/session-handover.mdで全体状況を把握

2. **次のタスク選択**
   - 未完了（`[ ]`）の項目を上から順に実装
   - 依存関係に注意（Phase順に進める）

3. **実装開始**
   - 実装開始時に `[ ]` を `[x]` に変更
   - 問題発生時はISSUE.mdに記録

4. **完了報告**
   - Phase完了時に状態を更新（⏸️ → 🔄 → ✅）
   - docs/session-handover.mdも更新

### チェックボックスの使い方

- `[ ]` 未着手
- `[x]` 完了
- `[~]` 部分完了（一部のみ実装済み）

### Phase状態の意味

- ⏸️ **未着手**: まだ開始していない
- 🔄 **進行中**: 現在作業中
- ✅ **完了**: すべての項目が完了
- ⚠️ **保留**: 問題により一時停止中

---

## 🔗 関連ドキュメント

- [README.md](README.md) - プロジェクト概要
- [CLAUDE.md](CLAUDE.md) - 開発ルール
- [docs/design.md](docs/design.md) - 設計ドキュメント
- [docs/session-handover.md](docs/session-handover.md) - セッション引き継ぎ情報
- [ISSUE.md](ISSUE.md) - 不具合管理表

---

*最終更新: 2026-01-18*
*管理者: Claude Sonnet 4.5*
