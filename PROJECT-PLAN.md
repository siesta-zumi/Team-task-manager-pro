# PROJECT-PLAN.md - プロジェクト実装計画書

このファイルはTeam Task Manager Proの実装手順を管理するチェックリストです。
上から順番に実装し、完了毎にチェックを付けてプロジェクトの進捗を管理します。

**セッション引き継ぎ時の注意**:
このファイルを確認して、どこまで完了しているか把握してから開発を継続してください。

---

## 📊 進捗状況サマリー

- **全体進捗**: 約40% (Phase 1-3完了、Phase 4 Step 1完了、Phase 5 Step 1-2完了、Phase 6完了)
- **完了Phase**: 4/16
- **完了ステップ**: Phase 4 Step 1/3, Phase 5 Step 1-2/4, Phase 6 Step 1-2/2
- **現在のステップ**: Phase 6完了
- **次のステップ候補**: Phase 4 Step 2 (フィルター・検索) or Phase 5 Step 3 (チェックリスト) (ユーザーと相談)

## 📋 段階的開発方針

**各Phaseはステップに分割され、段階的に実装します**:
- **Step 1 (最低限の機能)**: 各Phaseの最初のステップで基本動作を実現
- **Step 2 (基本機能)**: 実用的な機能を追加
- **Step 3以降 (拡張機能)**: さらなる機能拡張
- **柔軟な進行**: 各ステップ完了時、次のステップを続けるか別のPhaseに移るかをユーザーと相談

---

## Phase 1: プロジェクトセットアップ ✅

**状態**: ✅ 完了
**開始日**: 2026-01-18
**完了日**: 2026-01-18

### 実行項目

- [x] GitHubリポジトリ作成
  - [x] リポジトリ名: `Team-task-manager-pro`
  - [x] リポジトリURL: https://github.com/siesta-zumi/Team-task-manager-pro
  - [x] ローカルにクローン

- [x] Next.js 15プロジェクト初期化
  - [x] `npx create-next-app@latest` 実行
  - [x] TypeScript有効化
  - [x] App Router使用
  - [x] TailwindCSS v3設定
  - [x] ESLint設定

- [x] 依存関係のインストール
  - [x] `@supabase/supabase-js` インストール
  - [x] その他必要なパッケージ確認

- [x] 初回コミット・プッシュ
  - [x] `.gitignore` 設定確認
  - [x] 初回コミット作成
  - [x] `main` ブランチにプッシュ

**成果物**:
- ✅ 基本的なNext.jsプロジェクト構造
- ✅ package.json with 必要な依存関係
- ✅ TailwindCSS設定ファイル

---

## Phase 2: ドキュメント作成 ✅

**状態**: ✅ 完了
**開始日**: 2026-01-18
**完了日**: 2026-01-18

### 実行項目

- [x] README.md作成
  - [x] プロジェクト概要
  - [x] 技術スタック
  - [x] セットアップ手順
  - [x] 開発コマンド

- [x] CLAUDE.md作成（開発ルール）
  - [x] ディレクトリ構成
  - [x] コーディング規約
  - [x] Git コミットメッセージ規約
  - [x] よく使うコマンド一覧

- [x] docs/design.md作成（設計ドキュメント）
  - [x] 機能仕様
  - [x] データモデル（ER図）
  - [x] テーブル定義
  - [x] TypeScript型定義
  - [x] UI/UX設計（SharePoint風）

- [x] docs/session-handover.md作成
  - [x] プロジェクト概要
  - [x] 完了済みタスク一覧
  - [x] 既知の問題
  - [x] 次のステップ

- [x] ISSUE.md作成（不具合管理表）
  - [x] 現在の未解決課題
  - [x] Issue記録ルール
  - [x] フェーズ別Issue履歴

- [x] PROJECT-PLAN.md作成（このファイル）
  - [x] フェーズ別実装計画
  - [x] 実行項目チェックリスト

- [x] DEVELOPMENT-RULES.md作成（開発プロセスルール）
  - [x] 開発前の必須確認事項
  - [x] 問題発生時のルール
  - [x] Git運用ルール
  - [x] セッション引き継ぎルール

- [x] docs/FILE-STRUCTURE-GUIDE.md作成（ファイル構成ガイド）
  - [x] mdファイルの配置ルール
  - [x] ディレクトリ構成
  - [x] 判断フローチャート

- [x] docs/NOTIFICATION-GUIDE.md作成（通知機能ガイド）
  - [x] scripts/notify-completion.js作成
  - [x] クロスプラットフォーム対応（Windows/macOS/Linux）
  - [x] 4種類の通知音（success/question/error/info）
  - [x] デスクトップ通知機能

- [x] .env.local.example作成
  - [x] Supabase環境変数テンプレート
  - [x] Google GenAI APIキーテンプレート

- [x] CLAUDE.md更新
  - [x] AI運用5原則を冒頭に追加

**成果物**:
- ✅ 完全なプロジェクトドキュメント
- ✅ 開発ルールとコーディング規約
- ✅ 設計仕様書
- ✅ プロセスルールとファイル構成ガイド
- ✅ 音声通知システム

---

## Phase 3: Supabase基盤構築 ✅

**状態**: ✅ 完了
**開始日**: 2026-01-18
**完了日**: 2026-01-18

### 実行項目

- [x] Supabaseクライアント設定
  - [x] `lib/supabase.ts` 作成
  - [x] 環境変数設定（`.env.local.example`）
  - [x] createClient設定

- [x] TypeScript型定義
  - [x] `types/index.ts` - アプリケーション型定義
  - [x] `types/database.ts` - Supabase型定義
  - [x] Task, Member, Subtask, Assignment型

- [x] データベースマイグレーション
  - [x] `supabase/migrations/001_initial_schema.sql` 作成
    - [x] members テーブル
    - [x] tasks テーブル
    - [x] task_assignments テーブル
    - [x] subtasks テーブル
  - [x] `supabase/migrations/002_seed_data.sql` 作成
    - [x] サンプルメンバーデータ
    - [x] サンプルタスクデータ
    - [x] サンプル担当者データ
    - [x] サンプルチェックリストデータ

- [x] CRUD関数の実装
  - [x] `lib/tasks.ts` - タスク管理
    - [x] getTasks() - 全タスク取得
    - [x] getTaskById() - タスク詳細取得
    - [x] createTask() - タスク作成
    - [x] updateTask() - タスク更新
    - [x] deleteTask() - タスク削除
  - [x] `lib/members.ts` - メンバー管理
    - [x] getMembers() - 全メンバー取得
    - [x] getMemberById() - メンバー詳細取得
    - [x] createMember() - メンバー作成
    - [x] updateMember() - メンバー更新
  - [x] `lib/subtasks.ts` - チェックリスト管理
    - [x] getSubtasksByTaskId() - タスクのチェックリスト取得
    - [x] createSubtask() - チェックリスト作成
    - [x] updateSubtask() - チェックリスト更新
    - [x] deleteSubtask() - チェックリスト削除

**成果物**:
- ✅ Supabase接続設定
- ✅ 完全な型定義
- ✅ データベーススキーマ
- ✅ CRUD関数ライブラリ

**既知の問題**:
- 🟡 ISSUE-001: Supabase環境変数未設定エラー（回避策実装済み - プレースホルダー値で動作）

---

## Phase 4: タスク一覧ページ（3ステップ）

**全体状態**: 🔄 進行中（Phase 4 Step 1完了、Phase 4 Step 2が次）
**開始日**: 2026-01-18

---

### Phase 4 Step 1: UI実装（最低限の機能） ✅ 完了

**開始日**: 2026-01-18
**完了日**: 2026-01-18

#### 実行項目

- [x] ホームページ作成
  - [x] `app/page.tsx` 修正
  - [x] タイトルと説明
  - [x] タスク一覧へのリンク

- [x] タスク一覧ページ（基本）
  - [x] `app/tasks/page.tsx` 作成（Server Component）
  - [x] getTasks()でデータ取得
  - [x] エラーハンドリング
  - [x] `export const dynamic = 'force-dynamic'` 設定

- [x] タスクテーブルコンポーネント
  - [x] `components/TaskTable.tsx` 作成（Client Component）
  - [x] SharePoint風のテーブルデザイン
  - [x] ステータス色分け（未着手/進行中/完了/承認済み）
  - [x] 担当者アバター表示（最大3名 + 残り人数）
  - [x] 進捗バー表示
  - [x] 業務スコア表示
  - [x] 日付フォーマット（MM/DD）
  - [x] 行のホバー効果
  - [x] クリックイベント（onTaskClick）

- [x] 統計情報カード
  - [x] 総タスク数
  - [x] 進行中タスク数
  - [x] 完了タスク数
  - [x] 平均進捗率

- [x] フィルター・検索UI
  - [x] ステータス選択ドロップダウン（UIのみ）
  - [x] 検索入力フィールド（UIのみ）

- [x] 新規タスクボタン
  - [x] ボタンUI作成

- [x] エラーハンドリング改善
  - [x] Supabase未接続時のフォールバック処理
  - [x] lib/supabase.tsにプレースホルダー値追加
  - [x] lib/tasks.tsのエラーハンドリング改善
  - [x] app/tasks/page.tsxのエラー表示改善
  - [x] console.errorをconsole.warnに変更（Supabase未接続時）

#### 成果物
- ✅ タスク一覧ページ（基本機能）
- ✅ SharePoint風テーブルコンポーネント
- ✅ 統計情報ダッシュボード

#### 動作確認結果
- ✅ ローカル環境（http://localhost:54112/tasks）で正常動作確認済み
- ✅ タスク一覧の表示が正常に動作
- ✅ タスクテーブルの表示が正常に動作
- ✅ 統計情報カードの表示が正常に動作

---

### Phase 4 Step 2: フィルター・検索機能（基本機能） 🔄 次のタスク

**状態**: ⏸️ 未着手

#### 実行項目

- [ ] ステータスフィルターロジック
  - [ ] TaskTableをClient Componentに状態管理追加
  - [ ] ステータス選択でフィルタリング実装
  - [ ] "すべて"オプション対応

- [ ] タスク名検索ロジック
  - [ ] 検索入力での部分一致検索実装
  - [ ] リアルタイム検索（debounce処理）
  - [ ] 検索結果件数表示

- [ ] フィルター結果の表示
  - [ ] フィルタリング済みタスクの表示
  - [ ] フィルター条件のクリアボタン

#### 成果物
- ⏳ フィルター・検索機能（基本）

---

### Phase 4 Step 3: ソート・ページネーション（拡張機能） ⏸️ 未着手

**状態**: ⏸️ 未着手

#### 実行項目

- [ ] ソート機能
  - [ ] カラムヘッダークリックでソート
  - [ ] タスク名、ステータス、期限日、進捗率でソート
  - [ ] ソート方向切り替え（昇順/降順）
  - [ ] ソート方向インジケーター（↑↓）

- [ ] ページネーション
  - [ ] ページサイズ選択（10, 25, 50, 100）
  - [ ] ページ番号ボタン
  - [ ] 前へ/次へボタン
  - [ ] 総件数表示

- [ ] 状態永続化
  - [ ] URLクエリパラメータでフィルター/ソート/ページ状態保持
  - [ ] ブラウザバック/フォワード対応

#### 成果物
- ⏳ ソート機能
- ⏳ ページネーション
- ⏳ URL状態管理

---

## Phase 5: タスク詳細モーダル（4ステップ）

**全体状態**: 🔄 進行中（Phase 5 Step 1-2完了）
**開始日**: 2026-01-19

---

### Phase 5 Step 1: モーダルUI実装（最低限の機能） ✅ 完了

**開始日**: 2026-01-19
**完了日**: 2026-01-19

#### 実行項目

- [x] モーダルコンポーネント作成
  - [x] `components/TaskModal.tsx` 作成
  - [x] オーバーレイ背景、モーダルウィンドウ
  - [x] 閉じる機能（X、ESC、背景クリック）

- [x] app/tasks/page.tsx修正
  - [x] Server Component → Client Componentに変更
  - [x] モーダル開閉状態の管理
  - [x] TaskModalコンポーネント統合

- [x] components/TaskTable.tsx修正
  - [x] onTaskClickイベント実装
  - [x] タスク行クリックでtaskIdを親に通知

#### 成果物
- ✅ モーダルUIコンポーネント
- ✅ タスククリックでモーダルが開く機能

#### 動作確認結果
- ✅ タスク行クリックでモーダルが表示される
- ✅ Xボタン、ESCキー、背景クリックでモーダルが閉じる
- ✅ モーダル表示中はbodyスクロールが無効化される

---

### Phase 5 Step 2: タスク詳細表示・編集（基本機能） ✅ 完了

**開始日**: 2026-01-19
**完了日**: 2026-01-19

#### 実行項目

- [x] タスク詳細表示・編集フォーム
  - [x] タスク名、説明、ステータス、日付、スコア編集
  - [x] マニュアルリンク・フォルダリンク編集
  - [x] 繰り返し設定編集
  - [x] 保存・キャンセルボタン
  - [x] 保存中ローディング表示
  - [x] 保存成功/失敗のトースト通知

#### 成果物
- ✅ タスク詳細編集機能
- ✅ フォームバリデーション（タスク名必須、日付チェック、スコア範囲チェック）
- ✅ タスク更新後の一覧再取得機能

#### 動作確認結果
- ✅ タスク詳細がモーダルに表示される
- ✅ フォーム入力が正常に動作する
- ✅ バリデーションが機能する
- ✅ 保存が正常に動作する（モックデータ環境でも動作）
- ✅ 保存後にトースト通知が表示される
- ✅ 保存後にタスク一覧が自動更新される

---

### Phase 5 Step 3: チェックリスト機能（拡張機能） ⏸️ 未着手

**状態**: ⏸️ 未着手

#### 実行項目

- [ ] チェックリストCRUD
  - [ ] チェックリスト表示、追加、削除、編集
  - [ ] 進捗率自動計算（完了数/総数×100）

#### 成果物
- ⏳ チェックリスト機能

---

### Phase 5 Step 4: 担当者アサイン機能（拡張機能） ⏸️ 未着手

**状態**: ⏸️ 未着手

#### 実行項目

- [ ] 担当者アサイン
  - [ ] 担当者一覧表示、追加、削除
  - [ ] メイン/フォロー担当の区別
  - [ ] 負荷率表示（メイン100%、フォロー30%）

#### 成果物
- ⏳ 担当者アサイン機能

---

## Phase 6: 新規タスク作成（2ステップ）

**全体状態**: ✅ 完了
**開始日**: 2026-01-19
**完了日**: 2026-01-19

---

### Phase 6 Step 1: 新規作成UI（最低限の機能） ✅ 完了

**開始日**: 2026-01-19
**完了日**: 2026-01-19

#### 実行項目

- [x] 新規作成モーダル
  - [x] モーダルを新規作成モードで開く（taskId=null）
  - [x] フォーム初期値設定（ステータス: 未着手、開始日: 今日、終了日: 1週間後、スコア: 1）

#### 成果物
- ✅ 新規作成UI
- ✅ 新規作成モードのフォーム表示

#### 動作確認結果
- ✅ 新規タスクボタンでモーダルが開く
- ✅ フォームに初期値が設定される
- ✅ 新規作成モードと編集モードが正しく切り替わる

---

### Phase 6 Step 2: 作成機能実装（基本機能） ✅ 完了

**開始日**: 2026-01-19
**完了日**: 2026-01-19

#### 実行項目

- [x] タスク作成実行
  - [x] createTask() 実行
  - [x] バリデーション（タスク名必須、期限日>=開始日、スコア1-10）
  - [x] 保存成功/失敗のトースト通知
  - [x] 作成後のタスク一覧自動更新

#### 成果物
- ✅ タスク作成機能
- ✅ バリデーション機能
- ✅ 新規作成・更新の両方に対応した保存処理

#### 動作確認結果
- ✅ 新規タスクが正常に作成される（モックデータ環境でも動作）
- ✅ バリデーションが機能する
- ✅ 作成後にトースト通知が表示される
- ✅ 作成後にタスク一覧が自動更新される

---

## Phase 7-16: その他機能（詳細は後で展開）

以下のPhaseは、Phase 4-6完了後に詳細を展開します。

### Phase 7: フィルター・検索拡張（2ステップ）
- Phase 7 Step 1: 高度なフィルター（担当者、期限日、複数条件）
- Phase 7 Step 2: 状態永続化（URL、LocalStorage）

### Phase 8: ソート・ページネーション拡張（2ステップ）
- Phase 8 Step 1: 高度なソート（複数カラム、状態保存）
- Phase 8 Step 2: パフォーマンス最適化（useMemo、仮想スクロール）

### Phase 9: マニュアル機能（3ステップ）
- Phase 9 Step 1: マニュアルエディタUI（最低限の機能）
- Phase 9 Step 2: マニュアルCRUD機能（基本機能）
- Phase 9 Step 3: チェックリスト連動（拡張機能）

### Phase 10: チームダッシュボード（3ステップ）
- Phase 10 Step 1: ダッシュボードUI（最低限の機能）
- Phase 10 Step 2: メンバー別統計（基本機能）
- Phase 10 Step 3: 負荷可視化グラフ（拡張機能）

### Phase 11: カレンダー機能（3ステップ）
- Phase 11 Step 1: カレンダーUI（最低限の機能）
- Phase 11 Step 2: タスク表示（基本機能）
- Phase 11 Step 3: 承認ワークフロー（拡張機能）

### Phase 12: タスクリセット・アーカイブ（2ステップ）
- Phase 12 Step 1: リセット機能（最低限の機能）
- Phase 12 Step 2: アーカイブ管理（基本機能）

### Phase 13: AI機能統合（3ステップ）
- Phase 13 Step 1: Google GenAI設定（最低限の機能）
- Phase 13 Step 2: チェックリスト自動生成（基本機能）
- Phase 13 Step 3: 説明文清書（拡張機能）

### Phase 14: 認証機能（2ステップ、オプション）
- Phase 14 Step 1: Supabase Auth設定（最低限の機能）
- Phase 14 Step 2: RLSとセキュリティ（基本機能）

### Phase 15: テスト・品質保証（2ステップ）
- Phase 15 Step 1: 単体テスト（最低限の機能）
- Phase 15 Step 2: E2Eテスト（基本機能）

### Phase 16: デプロイ（2ステップ）
- Phase 16 Step 1: Vercelデプロイ（最低限の機能）
- Phase 16 Step 2: 本番環境整備（基本機能）

---

## 📝 開発ガイドライン

### セッション引き継ぎ時の手順

1. **現状確認**
   - このファイル（PROJECT-PLAN.md）を確認
   - ISSUE.mdで未解決課題を確認
   - docs/session-handover.mdで全体状況を把握

2. **次のタスク選択**
   - 未完了（`[ ]`）のステップを上から順に実装
   - **各ステップ完了時**: ユーザーと相談して次のステップを続けるか、別のPhaseに移るかを決定
   - 依存関係に注意（Phase順推奨だが、優先度に応じて柔軟に変更可）

3. **実装開始**
   - 実装開始時に `[ ]` を `[x]` に変更
   - ステップのステータスを ⏸️ → 🔄 に更新
   - 問題発生時はISSUE.mdに記録

4. **完了報告**
   - ステップ完了時に状態を 🔄 → ✅ に更新
   - Phase全体完了時に全体状態を ✅ に更新
   - docs/session-handover.mdも更新
   - **ユーザーに次のステップを相談**

### チェックボックスの使い方

- `[ ]` 未着手
- `[x]` 完了
- `[~]` 部分完了（一部のみ実装済み）

### Phase状態の意味

- ⏸️ **未着手**: まだ開始していない
- 🔄 **進行中**: 現在作業中
- ✅ **完了**: すべての項目が完了
- ⚠️ **保留**: 問題により一時停止中

---

## 🔗 関連ドキュメント

- [README.md](README.md) - プロジェクト概要
- [CLAUDE.md](CLAUDE.md) - 開発ルール
- [DEVELOPMENT-RULES.md](DEVELOPMENT-RULES.md) - 開発プロセスルール
- [docs/design.md](docs/design.md) - 設計ドキュメント
- [docs/session-handover.md](docs/session-handover.md) - セッション引き継ぎ情報
- [docs/FILE-STRUCTURE-GUIDE.md](docs/FILE-STRUCTURE-GUIDE.md) - ファイル構成ガイド
- [docs/NOTIFICATION-GUIDE.md](docs/NOTIFICATION-GUIDE.md) - 通知機能ガイド
- [ISSUE.md](ISSUE.md) - 不具合管理表

---

*最終更新: 2026-01-19 (Phase 6完了 - 新規タスク作成機能実装完了)*
*管理者: Claude Sonnet 4.5*
